@using Microsoft.AspNetCore.Components.Forms
@using warehouseapp.ViewModels.Category

@namespace warehouseapp.Components.Category

<EditForm Model="Model" OnValidSubmit="HandleValidSubmit">
    <DataAnnotationsValidator />

    <div class="card shadow-sm p-4">

        <div class="mb-3">
            <label class="form-label">Category Name</label>
            <InputText class="form-control"
                       @bind-Value="Model.Name" />
            <ValidationMessage For="@(() => Model.Name)" />
        </div>

        <div class="mb-3">
            <label class="form-label">Parent Category</label>

            <InputSelect class="form-select"
                         TValue="int?"
                         @bind-Value="Model.ParentCategoryId">

                <option value="">-- No Parent (Root) --</option>

                @foreach (var c in ParentCategories.Where(c => c.Id != CurrentCategoryId))
                {
                    <option value="@c.Id">@c.Name</option>
                }
            </InputSelect>
        </div>

        <div class="mt-4 d-flex justify-content-end">
            <button type="submit"
                    class="btn btn-primary px-4"
                    disabled="@IsSaving">
                @(IsSaving ? "Saving..." : ButtonText)
            </button>
        </div>

    </div>
</EditForm>

@code {
    [Parameter] public CategoryRequestViewModel Model { get; set; } = new();
    [Parameter] public List<CategorySelectItemViewModel> ParentCategories { get; set; } = new();
    [Parameter] public int? CurrentCategoryId { get; set; }
    [Parameter] public EventCallback OnSubmit { get; set; }
    [Parameter] public bool IsSaving { get; set; }
    [Parameter] public string ButtonText { get; set; } = "Save";

    private Task HandleValidSubmit()
        => OnSubmit.InvokeAsync();
}
